> Exercise 3.11
>
> In section 3.2.3 we saw how the environment model described the
> behavior of procedures with local state. Now we have seen how internal
> definitions work. A typical message-passing procedure contains both of
> these aspects. Consider the bank account procedure of section 3.1.1:
>
> ```scheme
> (define (make-account balance)
>   (define (withdraw amount)
>     (if (>= balance amount)
>         (begin (set! balance (- balance amount))
>                balance)
>         "Insufficient funds"))
>   (define (deposit amount)
>     (set! balance (+ balance amount))
>     balance)
>   (define (dispatch m)
>     (cond ((eq? m 'withdraw) withdraw)
>           ((eq? m 'deposit) deposit)
>           (else (error "Unknown request -- MAKE-ACCOUNT"
>                        m))))
>   dispatch)
>   ```
> Show the environment structure generated by the sequence of interactions
>
> ```scheme
> (define acc (make-account 50))
>
> ((acc 'deposit) 40)
> 90
>
> ((acc 'withdraw) 60)
> 30
> ```
>
> Where is the local state for acc kept? Suppose we define another account
>
> ```scheme
> (define acc2 (make-account 100))
> ```
>
> How are the local states for the two accounts kept distinct? Which
> parts of the environment structure are shared between acc and acc2?

Initial environment with `make-account` defined:

    ```
      global env
          |
          v
    +----------------+
    |                |
    | make-account:---->(@)-(@) parameters: balance
    |                |   |      body: (define ...)
    |                |<--.
    +----------------+
    ```

(define acc (make-account 50))

    ```
      global env
          |
          v
    +----------------+
    |                |
    | make-account:----->(@)-(@)--> parameters: balance
    |                |    |         body: (define (withdraw ...))
    |                |<---.
    |                |
    |          acc:------------------------.
    |                |                     |
    |                |    E1               |
    |                |  +-------------+    |
    |                |  |             |    v
    |                |  | dispatch:-----> (@)-(@) parameters: m
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | withdraw:-----> (@)-(@) parameters: amount
    |                |  |             |    |      body: (if ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | deposit:------> (@)-(@) parameters: amount
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  | balance: 50 |
    |                |  +-------------+
    |                |
    +----------------+
    ```

((acc 'deposit) 40)

    ```
      global env
          |
          v
    +----------------+
    |                |
    | make-account:----->(@)-(@)--> parameters: balance
    |                |    |         body: (define (withdraw ...))
    |                |<---.
    |                |
    |          acc:------------------------.
    |                |                     |
    |                |    E1               |
    |                |  +-------------+    |
    |                |  |             |    v
    |                |  | dispatch:-----> (@)-(@) parameters: m
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | withdraw:-----> (@)-(@) parameters: amount
    |                |  |             |    |      body: (if ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | deposit:------> (@)-(@) parameters: amount
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  | balance: 50 |
    |                |  +-------------+
    |                |         ^   ^------------.
    |                |         |                |
    |                |    E2   |            E3  |
    |                |  +-------------+   +------------+
    |                |  | m: 'deposit |   | amount: 40 |
    |                |  +-------------+   +------------+
    |                |
    +----------------+
    ```

((acc 'withdraw) 60)

    ```
      global env
          |
          v
    +----------------+
    |                |
    | make-account:----->(@)-(@)--> parameters: balance
    |                |    |         body: (define (withdraw ...))
    |                |<---.
    |                |
    |          acc:------------------------.
    |                |                     |
    |                |    E1               |
    |                |  +-------------+    |
    |                |  |             |    v
    |                |  | dispatch:-----> (@)-(@) parameters: m
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | withdraw:-----> (@)-(@) parameters: amount
    |                |  |             |    |      body: (if ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | deposit:------> (@)-(@) parameters: amount
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  | balance: 90 |
    |                |  +-------------+
    |                |         ^   ^--------------.
    |                |         |                  |
    |                |    E2   |             E3   |
    |                |  +--------------+   +------------+
    |                |  | m: 'withdraw |   | amount: 60 |
    |                |  +--------------+   +------------+
    |                |
    +----------------+
    ```

(define acc2 (make-account 100))

    ```
      global env
          |
          v
    +----------------+
    |                |
    | make-account:----->(@)-(@)--> parameters: balance
    |                |    |         body: (define (withdraw ...))
    |                |<---.
    |                |
    |          acc:------------------------.
    |                |                     |
    |                |    E1               |
    |                |  +-------------+    |
    |                |  |             |    v
    |                |  | dispatch:-----> (@)-(@) parameters: m
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | withdraw:-----> (@)-(@) parameters: amount
    |                |  |             |    |      body: (if ...)
    |                |  |             |<---.
    |                |  |             |
    |                |  | deposit:------> (@)-(@) parameters: amount
    |                |  |             |    |      body: (cond ...)
    |                |  |             |<---.
    |                |  | balance: 40 |
    |                |  +-------------+
    |                |
    |                |
    |         acc2:-------------------------.
    |                |                      |
    |                |    E2                |
    |                |  +--------------+    |
    |                |  |              |    v
    |                |  | dispatch:------> (@)-(@) parameters: m
    |                |  |              |    |      body: (cond ...)
    |                |  |              |<---.
    |                |  |              |
    |                |  | withdraw:------> (@)-(@) parameters: amount
    |                |  |              |    |      body: (if ...)
    |                |  |              |<---.
    |                |  |              |
    |                |  | deposit:-------> (@)-(@) parameters: amount
    |                |  |              |    |      body: (cond ...)
    |                |  |              |<---.
    |                |  | balance: 100 |
    |                |  +-------------+
    +----------------+
    ```
